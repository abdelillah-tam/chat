<main class="h-full w-full flex flex-col">
  @if(messages.length === 0){
  <p class="w-full text-center bg-gray-500 text-white">No messages here</p>
  }

  <div
    class="basis-[94%] flex flex-col py-3 bg-white rounded-md overflow-y-auto"
  >
    @for(msg of messages; track msg.timestamp){
    <ul
      class="flex px-5"
      [ngClass]="
        msg.senderId === getCurrentObjectId()
          ? 'justify-end flex-row-reverse'
          : 'justify-start flex-row'
      "
    >
      <li class="w-11 rounded-full">
        @if($first || messages[$index].senderId !==
        messages[$index-1].senderId){
        <img src="./assets/user.jpg" class="rounded-full" />
        }
      </li>
      <li class="w-full flex flex-col">
        <div
          class="w-full flex text-xl"
          [ngClass]="
            msg.senderId === getCurrentObjectId()
              ? 'justify-end pr-2'
              : 'justify-start pl-2'
          "
        >
          @if($first || messages[$index].senderId !== messages[$index -
          1].senderId){
          <p>
            {{
              msg.senderId === senderUser?.objectId
                ? senderUser?.firstName
                : receiverUser?.firstName
            }}
            {{
              msg.senderId === senderUser?.objectId
                ? senderUser?.lastName
                : receiverUser?.lastName
            }}
          </p>
          }
        </div>
        <div
          class="flex items-center select-text"
          [ngClass]="
            msg.senderId === getCurrentObjectId()
              ? 'pr-2 flex-row-reverse'
              : 'flex-row pl-2'
          "
        >
          <p class="text-lg font-light">
            {{ msg.messageText }}
          </p>
          <p class="ml-2 font-light text-xs px-2">
            {{ msg.timestamp | date : "hh:mm aa" }}
          </p>
        </div>
        @if (msg.imageUrl.length > 0) {
        <div
          class="w-full flex"
          [ngClass]="
            msg.senderId === getCurrentObjectId()
              ? 'justify-end pr-2'
              : 'justify-start pl-2'
          "
        >
          <img class="w-1/3 h-full object-contain" [src]="msg.imageUrl" />
        </div>
        }
      </li>
    </ul>
    } @empty{ }
  </div>
  <div class="basis-[6%] flex items-center bg-white rounded-md pb-3">
    <mat-form-field
      class="relative basis-[90%] w-full h-full"
      subscriptSizing="dynamic"
      appearance="outline"
    >
      <mat-label>Message</mat-label>
      <input
        matInput
        placeholder="Type a message"
        [(ngModel)]="text"
        (keydown.enter)="sendMessage()"
      />

      <div
        class="relative w-[20%] h-[20%]"
        [ngClass]="file === null ? 'hidden' : 'block'"
      >
        <button
          class="absolute right-0 mt-1 mr-1 w-7 h-7 cursor-pointer border border-gray-500 rounded-full border-solid overflow-hidden"
          (click)="removeImage()"
          type="button"
        >
          <mat-icon class="mat-icon-two" fontIcon="close"></mat-icon>
        </button>
        <img class="w-full h-full object-contain" [src]="imageUrl" />
      </div>
    </mat-form-field>

    <button class="basis-[5%]">
      <input
        class="hidden"
        type="file"
        id="inputFile"
        (change)="onImageAdded($event)"
        accept="image/*"
      />
      <label class="right-0 flex items-center" for="inputFile"
        ><mat-icon fontIcon="attach_file"></mat-icon
      ></label>
    </button>
    <button class="basis-[5%] flex items-center p-2" (click)="sendMessage()">
      <mat-icon class="cursor-pointer" color="#F6EFEE">send</mat-icon>
    </button>
  </div>
</main>
